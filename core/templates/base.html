{% load static %}
{% if not user.is_authenticated or not user.is_staff %}
<div style="text-align:center; margin-top:50px;">
    <h2>üö´ Acesso Negado</h2>
    <p>Voc√™ precisa estar autenticado como administrador para acessar este sistema.</p>
    <a href="{% url 'login' %}" class="btn btn-primary mt-3">Ir para login</a>
</div>
{% else %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Adega Mufasa | Dashboards{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/jpeg" href="{% static 'images/mufasa.png' %}">
    <style>
        html, body { height: 100%; margin: 0; }
        body { background-color: #f8f9fa; overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh; }
        main { flex: 1; margin-top: 70px; padding: 1.5rem; }
        /* Sidebar */
        .sidebar { position: fixed; top:0; left:-260px; width:260px; height:100%; background:#212529; color:#f8f9fa; transition:left 0.3s ease; z-index:1040; display:flex; flex-direction:column; padding-top:70px;}
        .sidebar.show { left:0; }
        .sidebar h6 { padding:0.75rem 1.25rem; text-transform:uppercase; font-size:0.8rem; color:#adb5bd; letter-spacing:1px; margin-top:0.5rem;}
        /* Subir o bot√£o de logout acima do rodap√© */
.sidebar .logout {
    margin-top: auto;  /* mant√©m empurrando para baixo */
    padding: 1rem;
    z-index: 1100;     /* acima do footer */
    position: relative; /* garante que z-index funcione */
}
        /* Menu Accordion */
        .menu-btn { background:none; border:none; color:#f8f9fa; font-weight:500; padding:0.75rem 1.25rem; text-align:left; width:100%; cursor:pointer; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:0.3s; margin-bottom:2px; }
        .menu-btn:hover { background:#28a745; color:#fff; }
        .submenu { display:none; flex-direction:column; }
        .submenu a { color:#f8f9fa; text-decoration:none; padding:0.5rem 2rem; font-size:0.9rem; transition:0.2s; border-radius:6px; }
        .submenu a:hover { background:#28a745; color:#fff; }
        /* Overlay */
        .sidebar-overlay { position: fixed; inset:0; background:rgba(0,0,0,0.5); display:none; z-index:1030;}
        .sidebar-overlay.show { display:block; }
        /* Footer sempre na parte inferior */
        footer { background-color: #000; color: #d4af37; padding: 10px; width: 100%; box-shadow: 0px -3px 10px rgba(0,0,0,0.2); transition: background 0.3s, color 0.3s; flex-shrink: 0; }
        .footer-content { display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; }
        .footer-content img { height: 70px; border-radius: 6px; border: 2px solid #d4af37; transition: transform 0.3s ease; }
        .footer-content img:hover { transform: scale(1.05); }
        .footer-text { margin-top: 8px; font-size: 0.8rem; }
        /* Texto brilhando */
        .connect-text {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #d4af37;
            font-weight: bold;
            text-decoration: none;
            font-size: 1rem;
            animation: glow 1.5s infinite alternate;
            z-index: 2000;
        }
        @keyframes glow {
            from { text-shadow: 0 0 5px #d4af37, 0 0 10px #d4af37; }
            to { text-shadow: 0 0 20px #ffd700, 0 0 30px #ffec8b; }
        }
        .connect-text:hover { color: #fff; }

        .navbar.bg-dark {
    background-color: #000 !important;
}

    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-dark fixed-top shadow">
        <div class="container-fluid">
            <button class="btn btn-outline-light me-3" id="menu-toggle">‚ò∞</button>
            <a class="navbar-brand d-flex align-items-center" href="/">
                <img src="{% static 'images/mufasa.png' %}" alt="Adega Mufasa" width="35" class="me-2">
                Adega Mufasa Gest√£o
            </a>
        </div>
    </nav>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebarMenu">
        <h6>Navega√ß√£o</h6>
        <button class="menu-btn" onclick="window.location.href='{% url 'painel' %}'">Painel</button>
        <!-- Vendas -->
        <button class="menu-btn"> Estat√≠sticas de Vendas ‚ñæ</button>
        <div class="submenu">
            <a href="{% url 'dash_vendas' %}">Relat√≥rios de Vendas</a>
            <a href="{% url 'dash_vendas_graficos' %}">Relat√≥rios Gr√°ficos de Vendas</a>
        </div>

        <!-- Estoque -->
        <button class="menu-btn">Estoque ‚ñæ</button>
        <div class="submenu">
            <a href="{% url 'dashboard_estoque' %}">Relat√≥rios Gr√°ficos do Estoque</a>
            <a href="{% url 'dash_stock' %}">Relat√≥rios de Sa√≠das de Estoque</a>
            <a href="{% url 'dash_stock_grafico' %}">Relat√≥rios Gr√°ficos de Sa√≠das de Estoque</a>
        </div>
        <!-- Compras -->
        <button class="menu-btn">Compras ‚ñæ</button>
        <div class="submenu">
            <a href="{% url 'dash_compras' %}">Lista de Compras</a>
        </div>
        <!-- Financeiro -->
        <button class="menu-btn">Financeiro ‚ñæ</button>
        <div class="submenu">
            <a href="{% url 'balanco' %}">Balan√ßo Financeiro</a>

        </div>
        <!-- Funcion√°rios -->
        <button class="menu-btn">√Ärea de Funcion√°rios ‚ñæ</button>
        <div class="submenu">
            <a href="{% url 'usuario_criar' %}">Criar Novos Funcion√°rios</a>
        </div>

        <div class="logout mt-auto">
            <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger w-100">üö™ Logout</button>
            </form>
        </div>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <main>
        {% block content %}{% endblock %}
        {% block grafico %}{% endblock %}
    </main>
    <footer>
        <div class="footer-content">
            <img src="{% static 'images/mufasa.png' %}" alt="Imagem 1">
            <img src="{% static 'images/atom.png' %}" alt="Imagem 2">
        </div>
        <div class="footer-text">
            &copy; {{ year|default:"2025" }} Gest√£o Adega Mufasa - Todos os direitos reservados.
        </div>
    </footer>

    <!-- Texto brilhando -->
    <a href="/admin/" class="connect-text">Conecte-se ao servidor</a>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebarMenu');
        const overlay = document.getElementById('sidebarOverlay');

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.remove('show');
            overlay.classList.remove('show');
        });

        // Accordion submenu
        const menuBtns = document.querySelectorAll('.menu-btn');
        menuBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const submenu = btn.nextElementSibling;
                const isVisible = submenu.style.display === 'flex';
                submenu.style.display = isVisible ? 'none' : 'flex';
            });
        });
    </script>
</body>
</html>
{% endif %}
