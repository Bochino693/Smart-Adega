{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Adega Mufasa Gestão{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/jpeg" href="{% static 'images/mufasa.png' %}">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f4f8, #dfe9f3);
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }

        /* --- CABEÇALHO MAIS ENXUTO --- */
        header {
            padding: 10px 15px;
            background-color: #000;
            color: #fff;
            backdrop-filter: blur(5px);
            box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        header h1 {
            font-size: 1.4rem;
            color: #fff;
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        nav a {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #fff;
            font-weight: bold;
            background: #111;
            padding: 10px;
            border-radius: 10px;
            width: 100px;
            font-size: 0.85rem;
            box-shadow: 0px 3px 6px rgba(0,0,0,0.2);
            transition: 0.3s;
        }

        nav a:hover {
            background: #222;
            transform: translateY(-2px);
            color: #d4af37;
        }

        nav img {
            width: 35px;
            height: 35px;
            margin-bottom: 5px;
            object-fit: contain;
        }

        hr {
            border: none;
            height: 1.5px;
            background: #d4af37;
            margin-top: 5px;
        }

        /* --- BOTÃO SOL/LUA --- */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-toggle img {
            width: 35px;
            height: 35px;
            cursor: pointer;
            transition: transform 0.2s;
            opacity: 0.6;
        }

        .theme-toggle img.active {
            transform: scale(1.2);
            opacity: 1;
        }

       /* --- CONTEÚDO --- */
main {
    flex: 1;
    padding: 30px;
    margin-top: 10px;
    background-color: #ffffffcc; /* leve transparência */
    backdrop-filter: blur(5px);
    border-radius: 12px;
    width: 95%;             /* aumentei de 85% para 95% */
    max-width: 1400px;      /* aumentei de 1000px para 1400px */
    box-shadow: 0px 5px 15px rgba(0,0,0,0.15); /* sombra um pouco maior */
    transition: background 0.3s, color 0.3s;
}


        /* --- RODAPÉ MAIS ENXUTO --- */
        footer {
            background-color: #000;
            color: #d4af37;
            padding: 10px;
            width: 100%;
            box-shadow: 0px -3px 10px rgba(0,0,0,0.2);
            margin-top: auto;
            transition: background 0.3s, color 0.3s;
        }

        .footer-content {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .footer-content img {
            height: 70px;
            border-radius: 6px;
            border: 2px solid #d4af37;
            transition: transform 0.3s ease;
        }

        .footer-content img:hover {
            transform: scale(1.05);
        }

        .footer-text {
            margin-top: 8px;
            font-size: 0.8rem;
        }

        /* --- TEMA ESCURO --- */
        body.dark {
            background: linear-gradient(135deg, #1e1e1e, #121212);
            color: #eee;
        }

        body.dark header {
            background-color: #111;
            color: #eee;
        }

        body.dark nav a {
            background: #222;
            color: #eee;
        }

        body.dark nav a:hover {
            background: #333;
            color: #d4af37;
        }

        body.dark main {
            background-color: #1c1c1cdd;
            color: #f5f5f5;
        }

        body.dark footer {
            background-color: #111;
            color: #d4af37;
        }

        /* Dropdown hover */
        .user-icon .dropdown-item:hover {
            background-color: #222;
        }

        /* Hover específico para logout */
        .user-icon .dropdown-item.logout:hover {
            background-color: #660000;
        }


        nav.nav-icons a.active-nav {
    background: #d4af37;
    color: #000;
    transform: translateY(-2px);
}

nav.nav-icons a.active-nav img {
    filter: brightness(1.2);
}

#userDropdown {
    display: none;
    position: absolute;   /* relativo ao .user-icon */
    top: 65px;            /* logo abaixo do toggle do usuário */
    left: 0;              /* alinha à esquerda do container */
    background-color: #111;
    color: #fff;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    min-width: 180px;
    max-width: 250px;
    z-index: 9999;
    overflow: visible;
    transition: all 0.3s ease;
}



    </style>
    {% block head %}{% endblock %}
</head>
<body>

<header>
  <div class="header-content" style="display: flex; align-items: center; justify-content: space-between; width: 100%;">

    <!-- COLUNA ESQUERDA: Ícone ou login -->
    <div class="user-section" style="display: flex; align-items: center; gap: 10px;">
      {% if user.is_authenticated %}
        <div class="user-icon" style="position: relative;">
          <div id="userMenuToggle" style="cursor: pointer; display: flex; flex-direction: column; align-items: center;">
            <img src="{% static 'images/user-icon.png' %}" alt="Usuário" style="width:50px; height:50px; border-radius:50%; object-fit: cover;">
            <div style="font-size: 0.85rem; color: #fff; margin-top: 3px;">
              Bem-vindo {{ user.first_name }} {{ user.last_name }}
            </div>
          </div>

          <!-- Dropdown -->
          <div id="userDropdown" style="display:none; position:absolute; top:65px; left:0; background-color:#111; color:#fff; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.4); min-width:180px; z-index:9999;">
            <a href="{% url 'profile' %}" class="dropdown-item" style="display:block; padding:10px 15px; text-decoration:none; color:#fff;">Configurar Perfil</a>
            <form method="POST" action="{% url 'logout' %}" style="margin:0;">
              {% csrf_token %}
              <button type="submit" class="dropdown-item logout" style="display:block; width:100%; text-align:left; padding:10px 15px; border:none; background:none; color:#ff4d4d; cursor:pointer;">Sair</button>
            </form>
          </div>
        </div>
      {% else %}
        <a href="{% url 'login' %}" style="text-decoration:none; color:#fff; display:flex; flex-direction:column; align-items:center;">
          <img src="{% static 'images/user-icon.png' %}" alt="Usuário" style="width:50px; height:50px; border-radius:50%; object-fit:cover;">
          <div style="font-size:0.85rem; margin-top:3px;">Fazer login</div>
        </a>
      {% endif %}
    </div>

    <!-- COLUNA CENTRAL: TÍTULO SEMPRE CENTRALIZADO -->
    <div class="header-title" style="text-align: center; flex-grow: 1;">
      {% if user.is_authenticated %}
        {% if user.is_staff or user.is_superuser %}
          <h1>Gestão Adega || Admin - {{ user.username }}</h1>
        {% else %}
          <h1>Gestão Adega || Vendedor - {{ user.username }}</h1>
        {% endif %}
      {% else %}
        <h1>Gestão Adega || Anônimo</h1>
      {% endif %}
    </div>

    <!-- COLUNA DIREITA: Sol e Lua -->
    <div class="theme-toggle" style="display:flex; align-items:center; gap:10px;">
      <img src="{% static 'images/sun.png' %}" alt="Sol" id="sun" class="active" style="width:35px; height:35px; cursor:pointer;">
      <img src="{% static 'images/moon.png' %}" alt="Lua" id="moon" style="width:35px; height:35px; cursor:pointer;">
    </div>
  </div>
</header>


<nav class="nav-icons">
    <a href="{% url 'vender' %}">
        <img src="{% static 'images/sales-3.png' %}" alt="Vendas">
        <span>Vender</span>
    </a>
    <a href="{% url 'estoque' %}">
        <img src="{% static 'images/4573150.png' %}" alt="Estoque">
        <span>Estoque</span>
    </a>
    <a href="{% url 'produtos' %}">
        <img src="{% static 'images/historico.png' %}" alt="Produtos">
        <span>Histórico de Produtos</span>
    </a>
    <a href="{% url 'lead_dash' %}">
        <img src="{% static 'images/grafic.jpg' %}" alt="Dashboard">
        <span>Área de Administração</span>
    </a>
</nav>
<hr>

<main>
    {% block content %}{% endblock %}
</main>


<footer>
    <div class="footer-content">
        <img src="{% static 'images/mufasa.png' %}" alt="Imagem 1">
        <img src="{% static 'images/atom.png' %}" alt="Imagem 2">
    </div>
    <div class="footer-text">
        &copy; {{ year|default:"2025" }} Gestão Adega Mufasa - Todos os direitos reservados.
    </div>
</footer>

<script>
    const sun = document.getElementById("sun");
    const moon = document.getElementById("moon");
    const body = document.body;

    // Função para aplicar o tema salvo
    function aplicarTema(tema) {
        if (tema === "dark") {
            body.classList.add("dark");
            moon.classList.add("active");
            sun.classList.remove("active");
        } else {
            body.classList.remove("dark");
            sun.classList.add("active");
            moon.classList.remove("active");
        }
    }

    // Verifica no localStorage se já existe um tema salvo
    const temaSalvo = localStorage.getItem("tema");
    aplicarTema(temaSalvo || "light");

    // Clique no sol → modo claro
    sun.addEventListener("click", () => {
        localStorage.setItem("tema", "light");
        aplicarTema("light");
    });

    // Clique na lua → modo escuro
    moon.addEventListener("click", () => {
        localStorage.setItem("tema", "dark");
        aplicarTema("dark");
    });

    // Dropdown do usuário logado
    const userToggle = document.getElementById('userMenuToggle');
    const userDropdown = document.getElementById('userDropdown');

    if(userToggle) {
        userToggle.addEventListener('click', () => {
            if(userDropdown.style.display === 'none' || userDropdown.style.display === '') {
                userDropdown.style.display = 'block';
            } else {
                userDropdown.style.display = 'none';
            }
        });

        // Fecha dropdown se clicar fora
        document.addEventListener('click', (e) => {
            if (!userToggle.contains(e.target) && !userDropdown.contains(e.target)) {
                userDropdown.style.display = 'none';
            }
        });
    }

// Função para destacar o link de navegação ativo
    function destacarNavAtivo() {
        const navLinks = document.querySelectorAll('nav.nav-icons a');
        const urlAtual = window.location.pathname; // pega a URL atual sem domínio

        navLinks.forEach(link => {
            // Se o href do link for igual ao pathname atual, adiciona a classe 'active-nav'
            if(link.getAttribute('href') === urlAtual) {
                link.classList.add('active-nav');
            } else {
                link.classList.remove('active-nav');
            }
        });
    }

    // Chama a função ao carregar a página
    window.addEventListener('DOMContentLoaded', destacarNavAtivo);



document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('btnCriarUsuarioPadrao');
    if(btn) {
        btn.addEventListener('click', function() {
            if(confirm("Deseja realmente criar o usuário padrão admin123?")) {
                fetch("{% url 'criar_usuario_padrao' %}", {
                    method: "POST",
                    headers: {"X-CSRFToken": "{{ csrf_token }}"},
                })
                .then(res => res.json())
                .then(data => {
                    alert(data.message);
                    if(data.success) location.reload();
                })
                .catch(err => alert("Erro: " + err));
            }
        });
    }
});
</script>




</body>
</html>
